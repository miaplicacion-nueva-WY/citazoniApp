<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Dashboard Doctor</title>
  <link rel="stylesheet" href="dashboard-doctor.css" />
</head>
<body>
  <nav class="top-navbar">
    <div class="navbar-buttons">
      <a href="https://wa.me/5218112345678" target="_blank" class="nav-btn">ðŸ“± WhatsApp</a>
      <a href="quienes-somos.html" class="nav-btn">QuiÃ©nes Somos</a>
      <button class="logout-btn" onclick="logout()">ðŸšª Cerrar sesiÃ³n</button>
    </div>
  </nav>

  <!-- Bienvenida -->
  <header class="topbar">
    <span id="doctorName">Doctor</span>
  </header>

  <!-- Cards -->
  <div class="cards">
    <div class="card"><h3>Pacientes activos</h3><p id="countPatients">0</p></div>
    <div class="card"><h3>Citas hoy</h3><p id="countToday">0</p></div>
  </div>

  <!-- Mis Citas -->
  <section class="section">
    <h2>Mis Citas</h2>
    <table>
      <thead>
        <tr><th>Paciente</th><th>Fecha</th><th>Hora</th><th>Motivo</th></tr>
      </thead>
      <tbody id="appointmentsBody"></tbody>
    </table>
  </section>

  <script>
    const API = 'http://localhost:3000/api';
    const token = localStorage.getItem('token');
    if (!token) location.href='index.html';
    const payload = JSON.parse(atob(token.split('.')[1]));
    document.getElementById('doctorName').innerText = `Bienvenido, ${payload.nombre} ðŸ©º`;

    function logout() {
      localStorage.removeItem('token');
      location.href = 'index.html';
    }

    // Cargar estadÃ­sticas
    async function loadStats() {
      // Total pacientes asignados (ejemplo)
      const resP = await fetch(`${API}/users?rol=paciente`, {
        headers: { 'Authorization': token }
      });
      const users = await resP.json();
      document.getElementById('countPatients').innerText = users.length;

      // Citas de hoy
      const today = new Date().toISOString().split('T')[0];
      const resC = await fetch(`${API}/appointments/doctor?date=${today}`, {
        headers: { 'Authorization': token }
      });
      const citasHoy = await resC.json();
      document.getElementById('countToday').innerText = citasHoy.length;
    }

    // Cargar citas
    async function loadAppointments() {
      const res = await fetch(`${API}/appointments/doctor`, {
        headers: { 'Authorization': token }
      });
      const list = await res.json();
      const tbody = document.getElementById('appointmentsBody');
      tbody.innerHTML = '';
      list.forEach(c => {
        const tr = document.createElement('tr');
        tr.innerHTML = `
          <td>${c.paciente}</td>
          <td>${c.fecha}</td>
          <td>${c.hora}</td>
          <td>${c.motivo||''}</td>`;
        tbody.appendChild(tr);
      });
    }

    // Init
    loadStats();
    loadAppointments();
  </script>
</body>
</html>
